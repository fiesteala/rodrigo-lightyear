<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>¬°Misi√≥n Cumplida! - Rodrigo</title>
    
    <!-- === ETIQUETAS PARA VISTA PREVIA === -->
    <meta property="og:title" content="üöÄ MISI√ìN CUMPLIDA: Gracias por venir">
    <meta property="og:description" content="Gracias por acompa√±ar al Cadete Rodrigo en su primera vuelta al sol. ¬°Mira las fotos de la misi√≥n! üõ∏">
    <meta property="og:type" content="website">
    
    <!-- IMAGEN DE VISTA PREVIA -->
    <meta property="og:image" content="https://github.com/fiesteala/rodrigo-lightyear/blob/main/IMG_0611.png?raw=true">
    <meta property="og:image:width" content="500">
    <meta property="og:image:height" content="500">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Orbitron para el look espacial -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Canvas Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --buzz-green: #74c045;
            --buzz-purple: #6b3fa0;
            --buzz-white: #ffffff;
            --buzz-red: #da2c38;
            --space-dark: #0f172a;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--space-dark);
            color: var(--buzz-white);
            overflow-x: hidden;
            touch-action: manipulation;
        }

        .font-space {
            font-family: 'Orbitron', sans-serif;
        }

        /* Fondo de Estrellas Animado */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            background: radial-gradient(ellipse at bottom, #1b2735 0%, #090a0f 100%);
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle var(--duration) ease-in-out infinite;
            opacity: 0;
        }

        @keyframes twinkle {
            0% { opacity: 0; transform: scale(0.5); }
            50% { opacity: 0.8; transform: scale(1.2); }
            100% { opacity: 0; transform: scale(0.5); }
        }

        /* Animaci√≥n de Entrada */
        .scan-line {
            width: 100%;
            height: 4px;
            background: #74c045;
            box-shadow: 0 0 10px #74c045;
            animation: scan 2s linear infinite;
            opacity: 0.7;
        }

        @keyframes scan {
            0% { transform: translateY(-100vh); }
            100% { transform: translateY(100vh); }
        }

        .hidden-content {
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in;
        }

        .card-border {
            border: 2px solid var(--buzz-green);
            box-shadow: 0 0 15px rgba(116, 192, 69, 0.4);
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        /* Alas decorativas y Marco de Foto */
        .wing-pattern {
            background-image: repeating-linear-gradient(
                45deg,
                var(--buzz-red),
                var(--buzz-red) 10px,
                var(--buzz-white) 10px,
                var(--buzz-white) 20px
            );
        }

        /* Efecto Holo para la foto */
        .holo-border {
            position: relative;
            background: linear-gradient(135deg, #74c045, #6b3fa0);
            padding: 4px;
            border-radius: 1rem;
            box-shadow: 0 0 25px rgba(116, 192, 69, 0.5);
        }
        
        .photo-inner {
            background-color: white;
            border-radius: 0.8rem;
            overflow: hidden;
            position: relative;
        }

        /* === ESTILOS GALER√çA MASONRY MEJORADOS === */
        .gallery-masonry {
            column-count: 1; /* Por defecto 1 columna para m√≥viles */
            column-gap: 1rem;
            width: 100%;
        }
        @media (min-width: 640px) {
            .gallery-masonry {
                column-count: 2; /* Tabletas */
            }
        }
        @media (min-width: 1024px) {
            .gallery-masonry {
                column-count: 3; /* Desktop */
            }
        }

        .gallery-item {
            break-inside: avoid; /* Evita que las fotos se partan */
            margin-bottom: 1rem;
            position: relative;
            border-radius: 0.5rem;
            overflow: hidden;
            transition: transform 0.3s ease;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            background: #1e293b;
            cursor: pointer;
            width: 100%;
            display: inline-block; /* Importante para masonry */
        }
        
        .gallery-item:hover {
            transform: scale(1.02);
            z-index: 10;
            box-shadow: 0 10px 15px -3px rgba(116, 192, 69, 0.3);
        }

        .gallery-img {
            width: 100%;
            height: auto;
            display: block;
            border-radius: 0.5rem;
            object-fit: cover;
        }

        /* Botones de Admin sobre la foto */
        .admin-overlay {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 20; /* Asegurar que est√© sobre la imagen */
        }
        .gallery-item:hover .admin-overlay,
        .gallery-item.show-admin .admin-overlay {
            opacity: 1;
        }

        /* Mensaje de Error */
        .error-message {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid #ef4444;
            padding: 1rem;
            border-radius: 0.5rem;
            font-size: 0.8rem;
            margin-top: 1rem;
            text-align: center;
        }
        
        /* Lightbox (Visor de pantalla completa) */
        #lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            z-index: 100;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #lightbox.active {
            display: flex;
            opacity: 1;
        }
        #lightbox-img {
            max-width: 90%;
            max-height: 80vh;
            border-radius: 8px;
            box-shadow: 0 0 30px rgba(116, 192, 69, 0.3);
            object-fit: contain;
        }

    </style>
</head>
<body class="h-screen w-full flex flex-col items-center justify-center relative">

    <!-- Fondo de Estrellas generado por JS -->
    <div id="stars-container" class="stars"></div>

    <!-- AUDIO -->
    <audio id="bg-music" loop>
        <source src="https://github.com/fiesteala/rodrigo-lightyear/raw/refs/heads/main/Buzz.mp3">
    </audio>

    <!-- PANTALLA 1: Intro Reporte -->
    <div id="intro-screen" class="flex flex-col items-center justify-center w-full h-full p-6 text-center z-10 transition-all duration-700">
        <div class="animate-pulse mb-6">
            <div class="w-24 h-24 rounded-full border-4 border-purple-500 flex items-center justify-center bg-gray-800 shadow-[0_0_20px_rgba(107,63,160,0.6)]">
                <i data-lucide="check-circle-2" class="w-12 h-12 text-purple-400"></i>
            </div>
        </div>
        
        <h1 class="font-space text-3xl text-green-400 mb-2 tracking-widest uppercase font-bold">FIN DE LA MISI√ìN</h1>
        <p class="text-blue-200 text-lg mb-8 animate-bounce">Reporte Entrante...</p>

        <div class="w-full max-w-xs bg-gray-800 rounded-lg p-4 border border-green-600 relative overflow-hidden group cursor-pointer" onclick="openReport()">
            <div class="scan-line absolute top-0 left-0"></div>
            <p class="font-space text-xl text-white font-bold uppercase tracking-wider">VER MENSAJE</p>
            <p class="text-xs text-green-400 mt-1">Acceso Autorizado</p>
        </div>
    </div>

    <!-- PANTALLA 2: Agradecimiento y Galer√≠a -->
    <div id="main-content" class="hidden-content w-full h-full absolute top-0 left-0 overflow-y-auto z-20 pb-10">
        
        <!-- Cabecera -->
        <div class="w-full h-16 bg-white flex items-center justify-between px-4 shadow-lg sticky top-0 z-30">
            <div class="flex gap-2">
                <div class="w-4 h-4 rounded-full bg-red-500 shadow-md"></div>
                <div class="w-4 h-4 rounded-full bg-green-500 shadow-md"></div>
                <div class="w-4 h-4 rounded-full bg-blue-500 shadow-md"></div>
            </div>
            <div class="flex items-center gap-3">
                <button onclick="toggleMusic()" id="music-btn" class="w-8 h-8 rounded-full border-2 border-purple-800 flex items-center justify-center text-purple-800 bg-white active:scale-90 transition-transform">
                    <i id="music-icon" data-lucide="volume-2" class="w-4 h-4"></i>
                </button>
                <div class="text-purple-800 font-bold font-space text-xs tracking-widest border-2 border-purple-800 px-2 rounded">MISSION LOG</div>
            </div>
        </div>

        <div class="p-5 flex flex-col items-center max-w-md mx-auto mt-4">
            
            <!-- SECCI√ìN: AGRADECIMIENTO -->
            <div class="text-center mb-6">
                <h2 class="font-space text-green-400 text-sm uppercase tracking-widest mb-1">Estatus: Completado</h2>
                <h1 class="font-space text-4xl font-black text-white italic" style="text-shadow: 3px 3px 0px #6b3fa0;">
                    ¬°GRACIAS!
                </h1>
                <p class="text-purple-300 font-space text-sm tracking-wider mt-1">POR VENIR A MI FIESTA</p>
            </div>

            <!-- FOTO PRINCIPAL -->
            <div class="relative w-full mb-8 text-center px-2">
                <div class="wing-pattern h-24 w-[110%] absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 -z-10 rounded-lg opacity-80 rotate-3"></div>
                
                <div class="holo-border rotate-[-2deg] transition-transform duration-500 hover:rotate-0 hover:scale-105">
                    <div class="photo-inner bg-gray-900">
                         <img src="https://github.com/fiesteala/rodrigo-lightyear/blob/main/IMG_0611.png?raw=true" 
                              alt="Rodrigo Lightyear" 
                              class="w-full h-auto object-cover block">
                         <div class="absolute inset-0 bg-gradient-to-tr from-purple-500/20 to-transparent pointer-events-none"></div>
                    </div>
                    <div class="absolute -top-3 left-1/2 -translate-x-1/2 w-20 h-6 bg-gray-300 rounded shadow-md border-b-4 border-gray-400 z-20 flex items-center justify-center">
                        <div class="w-12 h-1 bg-black/20 rounded-full"></div>
                    </div>
                </div>
            </div>

            <div class="card-border rounded-xl p-6 w-full text-center bg-gray-900/90 mb-6 backdrop-blur-md relative overflow-hidden">
                <div class="absolute top-0 right-0 w-12 h-12 border-t-2 border-r-2 border-green-500 rounded-tr-xl"></div>
                <div class="absolute bottom-0 left-0 w-12 h-12 border-b-2 border-l-2 border-green-500 rounded-bl-xl"></div>

                <p class="text-white text-lg mb-6 leading-relaxed font-light">
                    <span class="text-3xl text-green-400 block mb-2">‚ùù</span>
                    Cadete, gracias por acompa√±arme en mi primera aventura intergal√°ctica. Tu presencia hizo que esta misi√≥n fuera inolvidable.
                    <br><br>
                    <span class="font-bold text-purple-400 font-space">¬°Al infinito y m√°s all√°!</span>
                </p>
                
                <div class="grid grid-cols-2 gap-3 mt-4 border-t border-gray-700 pt-4">
                    <div class="bg-gray-800 p-2 rounded border border-purple-500/30">
                        <p class="text-[10px] text-gray-400 font-space uppercase">DIVERSI√ìN</p>
                        <p class="text-green-400 font-bold text-xl">100%</p>
                    </div>
                    <div class="bg-gray-800 p-2 rounded border border-purple-500/30">
                        <p class="text-[10px] text-gray-400 font-space uppercase">RECUERDOS</p>
                        <p class="text-purple-400 font-bold text-xl">‚àû</p>
                    </div>
                </div>
            </div>

            <!-- SECCI√ìN: GALER√çA -->
            <div id="gallery-section" class="w-full mt-8">
                <div class="flex items-center justify-center gap-2 mb-6">
                    <div class="h-[1px] bg-green-500 w-10"></div>
                    <!-- TRUCO: Haz click 5 veces en este t√≠tulo para activar modo admin -->
                    <h2 id="gallery-title" class="font-space text-lg text-green-400 uppercase tracking-widest cursor-pointer select-none">Galer√≠a de la Misi√≥n</h2>
                    <div class="h-[1px] bg-green-500 w-10"></div>
                </div>

                <!-- CONTROLES ADMIN (Ocultos por defecto) -->
                <div id="admin-controls" class="hidden mb-6 bg-gray-800 p-4 rounded-xl border border-red-500 w-full animate-pulse">
                    <h3 class="text-red-400 font-bold mb-2 font-space text-xs uppercase">Panel de Comandante</h3>
                    <p class="text-xs text-gray-400 mb-3">Sube tus fotos aqu√≠. Usamos Cloudinary para m√°xima velocidad.</p>
                    
                    <label class="block w-full cursor-pointer bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded text-center transition">
                        <i data-lucide="upload" class="inline w-4 h-4 mr-2"></i> Subir Fotos (Selecciona varias)
                        <input type="file" id="file-input" multiple accept="image/*" class="hidden" onchange="uploadPhotos(this.files)">
                    </label>
                    <div id="upload-status" class="mt-2 text-xs text-yellow-400 font-mono"></div>
                </div>

                <!-- MASONRY GRID -->
                <div id="gallery-grid" class="gallery-masonry w-full min-h-[200px]">
                    <!-- Las fotos se cargar√°n aqu√≠ din√°micamente -->
                    <div class="text-center text-gray-500 w-full col-span-2 py-10 italic animate-pulse">Conectando con la Base Estelar...</div>
                </div>
                
                <!-- Contenedor de errores -->
                <div id="error-container" class="w-full"></div>
            </div>

            
            <!-- Pie de p√°gina -->
            <div class="w-full mt-12 mb-4 flex flex-col items-center opacity-60">
                <div class="flex gap-2 mb-2">
                    <i data-lucide="star" class="w-3 h-3 text-yellow-500 fill-yellow-500"></i>
                    <i data-lucide="star" class="w-3 h-3 text-yellow-500 fill-yellow-500"></i>
                    <i data-lucide="star" class="w-3 h-3 text-yellow-500 fill-yellow-500"></i>
                </div>
                <p class="text-[10px] font-space text-gray-400 tracking-widest uppercase">
                    Rodrigo - 1 A√±o
                </p>
            </div>

        </div>
    </div>

    <!-- LIGHTBOX (Visor de pantalla completa) -->
    <div id="lightbox" onclick="closeLightbox()">
        <button class="absolute top-4 right-4 text-white hover:text-red-500 z-50 p-2">
            <i data-lucide="x" class="w-8 h-8"></i>
        </button>
        <img id="lightbox-img" src="" alt="Vista previa">
        <p class="text-white mt-4 font-space text-sm tracking-widest bg-black/50 px-4 py-1 rounded">RECUERDO VISUAL</p>
    </div>

    <!-- SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, deleteDoc, doc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // ==========================================
        //  ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è  CONFIGURACI√ìN ACTUALIZADA  ‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è
        // ==========================================

        // 1. Configuraci√≥n de CLOUDINARY
        const CLOUDINARY_CLOUD_NAME = "duy0mcqsh"; 
        const CLOUDINARY_PRESET = "jbbd0sxy"; 

        // 2. Configuraci√≥n de FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyDL9UEEvWKYE7QpctYrnu1rG644x05_4Wk",
            authDomain: "bodasofiayalejadro.firebaseapp.com",
            projectId: "bodasofiayalejadro",
            storageBucket: "bodasofiayalejadro.firebasestorage.app",
            messagingSenderId: "905632324437",
            appId: "1:905632324437:web:b7aead724b299cc3202ddc"
        };

        // ==========================================
        //  ‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è  FIN DE LA EDICI√ìN  ‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è
        // ==========================================

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const PHOTOS_COLLECTION = "rodrigo_cumple_1";
        let isAdminMode = false;

        // 1. Conexi√≥n
        signInAnonymously(auth).then(() => {
            console.log("Conectado.");
            loadPhotos();
        }).catch((e) => {
            document.getElementById("error-container").innerHTML = `<div class="error-message">Error Firebase Auth: ${e.message}</div>`;
        });

        // 2. Cargar Fotos
        function loadPhotos() {
            const q = query(collection(db, PHOTOS_COLLECTION), orderBy("timestamp", "desc"));
            
            onSnapshot(q, (snapshot) => {
                const grid = document.getElementById("gallery-grid");
                if(snapshot.empty) {
                    grid.innerHTML = '<p class="text-gray-500 text-xs text-center w-full col-span-full mt-4">A√∫n no hay fotos.</p>';
                    return;
                }
                grid.innerHTML = "";
                snapshot.forEach((docSnap) => {
                    const data = docSnap.data();
                    const photoId = docSnap.id;
                    const div = document.createElement("div");
                    div.className = `gallery-item group ${isAdminMode ? 'show-admin' : ''}`;
                    
                    // A√±adimos evento onclick para abrir el lightbox
                    // y stopPropagation en los botones de admin para que no se abra la foto al borrarlas
                    div.innerHTML = `
                        <div onclick="window.openLightbox('${data.url}')">
                            <img src="${data.url}" class="gallery-img" loading="lazy" alt="Foto del evento" onerror="this.style.display='none'">
                        </div>
                        <div class="admin-overlay">
                            <button onclick="event.stopPropagation(); window.promotePhoto('${photoId}')" class="bg-blue-500 text-white p-1 rounded-full hover:bg-blue-600"><i data-lucide="arrow-up" class="w-3 h-3"></i></button>
                            <button onclick="event.stopPropagation(); window.deletePhoto('${photoId}')" class="bg-red-500 text-white p-1 rounded-full hover:bg-red-600"><i data-lucide="trash-2" class="w-3 h-3"></i></button>
                        </div>
                    `;
                    grid.appendChild(div);
                });
                lucide.createIcons();
            });
        }

        // 3. NUEVA FUNCI√ìN DE SUBIDA (A Cloudinary)
        window.uploadPhotos = async function(files) {
            if (!files.length) return;
            const status = document.getElementById("upload-status");
            const errDiv = document.getElementById("error-container");
            errDiv.innerHTML = "";

            let count = 0;
            status.innerText = `Subiendo ${files.length} fotos a la nube...`;

            for (const file of files) {
                const formData = new FormData();
                formData.append("file", file);
                formData.append("upload_preset", CLOUDINARY_PRESET); 

                try {
                    // Subir a Cloudinary
                    const response = await fetch(`https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`, {
                        method: "POST",
                        body: formData
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`Error Cloudinary: ${response.statusText} - ${errorData.error?.message || ''}`);
                    }
                    
                    const result = await response.json();
                    const secureUrl = result.secure_url; // URL de la foto

                    // Guardar URL en Firebase (Esto S√ç es gratis)
                    await addDoc(collection(db, PHOTOS_COLLECTION), {
                        url: secureUrl,
                        timestamp: serverTimestamp(),
                        originalName: file.name
                    });

                    count++;
                    status.innerText = `Listo: ${count} de ${files.length}`;

                } catch (error) {
                    console.error(error);
                    errDiv.innerHTML += `<div class="error-message">Fallo en ${file.name}: ${error.message}</div>`;
                }
            }
            if (count > 0) setTimeout(() => { status.innerText = "¬°Subida completa!"; }, 3000);
        };

        // 4. Gesti√≥n
        window.deletePhoto = async function(id) {
            if(!confirm("¬øBorrar?")) return;
            await deleteDoc(doc(db, PHOTOS_COLLECTION, id));
        };
        window.promotePhoto = async function(id) {
            await updateDoc(doc(db, PHOTOS_COLLECTION, id), { timestamp: serverTimestamp() });
        };

        // 5. Modo Admin
        let clicks = 0;
        document.getElementById("gallery-title").addEventListener("click", () => {
            clicks++;
            if (clicks === 5) {
                isAdminMode = !isAdminMode;
                document.getElementById("admin-controls").classList.toggle("hidden");
                document.querySelectorAll(".gallery-item").forEach(el => el.classList.toggle("show-admin"));
                clicks = 0;
            }
        });

        // 6. Funciones Globales del Lightbox (Fuera del module scope para acceso HTML)
        window.openLightbox = function(url) {
            const lightbox = document.getElementById('lightbox');
            const img = document.getElementById('lightbox-img');
            img.src = url;
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden'; // Evitar scroll
        }

        window.closeLightbox = function() {
            const lightbox = document.getElementById('lightbox');
            lightbox.classList.remove('active');
            document.body.style.overflow = 'auto'; // Restaurar scroll
            setTimeout(() => { document.getElementById('lightbox-img').src = ""; }, 300);
        }

    </script>

    <!-- SCRIPTS GENERALES -->
    <script>
        lucide.createIcons();
        const starsContainer = document.getElementById('stars-container');
        for (let i = 0; i < 50; i++) {
            const star = document.createElement('div');
            star.classList.add('star');
            star.style.left = `${Math.random() * 100}%`;
            star.style.top = `${Math.random() * 100}%`;
            const duration = Math.random() * (1.5 - 0.5) + 0.5;
            const size = Math.random() * (3 - 1) + 1;
            star.style.width = `${size}px`;
            star.style.height = `${size}px`;
            star.style.setProperty('--duration', `${duration}s`);
            starsContainer.appendChild(star);
        }

        function openReport() {
            const intro = document.getElementById('intro-screen');
            const main = document.getElementById('main-content');
            const audio = document.getElementById('bg-music');
            audio.play().catch(e => console.log("Autoplay blocked"));
            intro.style.opacity = '0';
            intro.style.transform = 'scale(1.5)';
            setTimeout(() => {
                intro.style.display = 'none';
                main.style.display = 'block';
                void main.offsetWidth;
                main.style.opacity = '1';
                launchConfetti();
            }, 500);
        }

        function toggleMusic() {
            const audio = document.getElementById('bg-music');
            const icon = document.getElementById('music-icon');
            if (audio.paused) {
                audio.play();
                icon.setAttribute('data-lucide', 'volume-2');
            } else {
                audio.pause();
                icon.setAttribute('data-lucide', 'volume-x');
            }
            lucide.createIcons();
        }

        function launchConfetti() {
            var duration = 3000;
            var end = Date.now() + duration;
            var interval = setInterval(function() {
                if (Date.now() > end) return clearInterval(interval);
                confetti({ particleCount: 50, spread: 360, origin: { x: Math.random(), y: Math.random() - 0.2 }, colors: ['#74c045', '#6b3fa0', '#ffffff'] });
            }, 250);
        }
    </script>
</body>
</html>